<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>CBT-X</title>
		<link rel="shortcut icon" href="../../../../favicon.ico" />
		<link rel="stylesheet" href="../../../../styles/style.css" />
		<script src="../../../../scripts/imageMapResizer.min.js"></script>
	</head>
	<body>
		<img
			src="../../../../images/CESDAlogo.png"
			class="topright"
			style="height: 100px"
		/>
		<img
			id="cockpit"
			class="cockpit"
			src="../../../../images/cockpitcanopy.jpg"
			usemap="#touchcockpit"
		/>
		<map name="touchcockpit">
			<area
				id="cockpit0"
				target=""
				alt="Fuel Pump"
				title="Fuel Pump"
				coords="790,639,805,681"
				shape="rect"
				cursor="pointer"
			/>
			<area
				id="cockpit1"
				target=""
				alt="Fuel Prime"
				title="Fuel Prime"
				coords="565,639,614,689"
				shape="rect"
				cursor="pointer"
			/>
			<area
				id="cockpit2"
				target=""
				alt="Throttle"
				title="Throttle"
				coords="725,996,831,1036"
				shape="rect"
				cursor="pointer"
			/>
			<area
				id="cockpit3"
				target=""
				alt="Throttle"
				title="Throttle"
				coords="726,751,832,790"
				shape="rect"
				cursor="pointer"
			/>
			<area
				id="cockpit4"
				target=""
				alt="Ignition"
				title="Ignition"
				coords="491,663,20"
				shape="circle"
				cursor="pointer"
			/>
			<area
				id="cockpit5"
				target=""
				alt="Starter"
				title="Starter"
				coords="579,142,594,195"
				shape="rect"
				cursor="pointer"
			/>
			<area
				id="cockpit6"
				target=""
				alt="Throttle Idle"
				title="Throttle Idle"
				coords="735,997,823,958"
				shape="rect"
				cursor="pointer"
			/>
			<area
				id="cockpit7"
				target=""
				alt="Oil Press"
				title="Oil Press"
				coords="1344,520,55"
				shape="circle"
				cursor="pointer"
			/>
			<area
				id="cockpit8"
				target=""
				alt="Prime"
				title="Prime"
				coords="617,636,657,686"
				shape="rect"
				cursor="pointer"
			/>
	        <area
				id="cockpit9"
				target=""
				alt="GEN"
				title="GEN"
				coords="535,142,555,192"
				shape="rect"
				cursor="pointer"
			/>
		    <area
				id="cockpit10"
				target=""
				alt="Starter"
				title="Starter"
				coords="572,144,592,194"
				shape="rect"
				cursor="pointer"
			/>
			
		</map>

		<div class="tablediv">
			<table id="table" align="right">
				<tr>
					<th colspan="2" id="itemtitle"><span>STARTING ENGINE</span></th>
				</tr>
				<tr id="item1">
					<td><span>1. Fuel Pump</span></td>
					<td align="right"><span>ON</span></td>
				</tr>
				<tr id="item2">
					<td><span>2. Fuel Prime</span></td>
					<td align="right"><span>ON</span></td>
				</tr>
				<tr id="item3">
					<td><span>3. Throttle</span></td>
					<td align="right"><span>FULL (10-15 sec.)</span></td>
				</tr>
				<tr id="item4">
					<td><span>4. Throttle</span></td>
					<td align="right"><span>IDLE to 1 cm.</span></td>
				</tr>
				<tr id="item5">
					<td><span>5. Toe Brakes</span></td>
					<td align="right"><span>Hold</span></td>
				</tr>
				<tr id="item6">
					<td><span>6. Propeller Area</span></td>
					<td align="right"><span>Clear</span></td>
				</tr>
				<tr id="item7">
					<td><span>7. Ignition Switch</span></td>
					<td align="right"><span>START (10 secs. Max)</span></td>
				</tr>
				<tr id="item8">
					<td><span>8. Starter Warning Light</span></td>
					<td align="right"><span>Illuminated while in START pos.</span></td>
				</tr>
				<tr id="item9">
					<td><span>9. Throttle</span></td>
					<td align="right"><span>1000 RPM</span></td>
				</tr>
				<tr id="item10">
					<td><span>10. Oil Pressure</span></td>
					<td align="right"><span>Check</span></td>
				</tr>
				<tr id="item11">
					<td><span>11. Fuel Prime</span></td>
					<td align="right"><span>OFF</span></td>
				</tr>
				<tr id="item12">
					<td><span>12. GEN Warning Light</span></td>
					<td align="right"><span>Check OFF</span></td>
				</tr>
				<tr id="item13">
					<td><span>13. Starter Warning Light</span></td>
					<td align="right"><span>Check OFF</span></td>
				</tr>
			</table>
		</div>
		<a href="../normal.html" class="btnback">BACK</a>
		<a href="../../../../menu.html" class="btnmenu">MENU</a>
		<div class="navdiv">
			<a class="btnnav startbtn" id="startbtn" onclick="start()">START</a>
			<a class="btnnav nextbtngrey" id="nextbtn">NEXT</a>
		</div>

		<script>
			// Main variables declaration
			const itemTitle = document.getElementById("itemtitle");
			const startBtn = document.getElementById("startbtn");
			const nextBtn = document.getElementById("nextbtn");
			const imgsRoute = "../../../../images/";
			let counter = 0;
			let allowCount = false;
			let tableTrIdArr = [];
			let clickableAreaElements = [];

			// Checks area HTML elements and stores each area id in the 'clickableAreaElements' Array
			const areaElements = document.getElementsByTagName("area");
			for (let i = 0; i < areaElements.length; i++) {
				if (areaElements[i].id !== "") {
					clickableAreaElements.push(areaElements[i]);
				}
			}
			console.log(clickableAreaElements);

			// Useful at Restart to acknowledge The CBT Activity has restarted on Page Reload
			if (sessionStorage.getItem("reloading") === "true") {
				sessionStorage.clear();
				start();
				startBtn.innerText = "RESTART";
			}

			// Restarts The CBT Activity
			function restart() {
				console.log("Restarting...");
				sessionStorage.setItem("reloading", "true");
				window.location.reload();
			}

			/* 
            Changes Inner Text on a selected HTML Element
               Invoke example: changeInnerText(startBtn, "RESTART")
         */
			function changeInnerText(element, string) {
				element.innerText = string;
			}

			/* 
            Applies 'highlight' class to selected HTML Element 
               Invoke example: highlightRow(tableElement)
         */
			function highlightRow(element) {
				element.classList.add("highlight");
			}

			/* 
            Modifies 'btn' styles adding/removing classes to selected Button
               Invoke example: disableBtn(nextBtn)
         */
			function disableBtn(element) {
				const lowerCaseName = element.id;
				element.classList.remove(lowerCaseName);
				element.classList.add(`${lowerCaseName}grey`);
			}

			/*
            Modifies 'btn' styles adding/removing classes to selected Button
               Invoke example: enableBtn(nextBtn)
         */
			function enableBtn(element) {
				const lowerCaseName = element.id;
				element.classList.remove(`${lowerCaseName}grey`);
				element.classList.add(lowerCaseName);
			}

			/* 
            Adds clickable functionalities to maptag elements.
               The maptag elements are selected from their index number in the clickableAreaElements Array (always starting at 0).
               The functionEventString accepts two string as options: 'continueCount(event)' or 'changeImage(event)'.
               Invoke example: setMapTagEvent(4, 'changeImage(event)');
         */
			function setMapTagEvent(elementNumber, functionEventString) {
				clickableAreaElements[elementNumber].classList.add("clickable");
				clickableAreaElements[elementNumber].setAttribute(
					"onclick",
					functionEventString
				);
			}

			/* 
            Removes clickable functionalities to maptag elements.
               The maptag elements are selected from their index number in the clickableAreaElements Array (always starting at 0).
               Invoke example: unsetMapTagEvent(4);
         */
			function unsetMapTagEvent(elementNumber) {
				clickableAreaElements[elementNumber].classList.remove("clickable");
				clickableAreaElements[elementNumber].removeAttribute("onclick");
			}

			// Starts The CBT Activity
			function start() {
				if (!allowCount) {
					itemTitle.classList.add("titlehighlight");
					startBtn.classList.remove("startbtn");
					startBtn.classList.add("startbtngrey");
					nextBtn.classList.remove("nextbtngrey");
					nextBtn.classList.add("nextbtn");
					// Checks `tr` HTML elements and stores each one id in the 'tableTrIdArr' Array
					const tableRows = document.getElementsByTagName("tr");
					for (let i = 0; i < tableRows.length; i++) {
						if (tableRows[i].id !== "") {
							tableTrIdArr.push(tableRows[i].id);
						}
					}
					startBtn.setAttribute("onclick", "restart()");
					changeInnerText(startBtn, "RESTART");
					changeInnerText(nextBtn, "TOUCH");
					disableBtn(nextBtn);
					setMapTagEvent(0, "changeImage(event)");
				}
			}

			// ACTIONS associated to the event click at `nextBtn`
			nextBtn.addEventListener("click", () => {
				if (allowCount) {
					counter++;
					console.log("Estoy en Next Btn: ", counter);
					/* La variable 'tableElement' se actualiza en cada nextBtn click (cuando ésté está habilitado) 
               agarrando el valor actual de counter y buscando el elemento de la tabla que corresponda a 'item+counter'
               */
					const tableElement = document.getElementById(`item${counter}`);

					/*
               A continuación, desarrollar las condiciones (en función del valor de counter) para ejecutar las funciones deseadas en cada caso
               */
					if (counter === 5) {
						// Applies 'highlight' class to selected HTML Element
						highlightRow(tableElement);
					} else if (counter === 6) {
						highlightRow(tableElement);
						setMapTagEvent(4, "changeImage(event)");
						allowCount = false;
						changeInnerText(nextBtn, "TOUCH")
						disableBtn(nextBtn)
					}
					// else if (counter < 4) {
					// 	highlightRow(tableElement);
					// } else if (counter === 4) {
					// 	highlightRow(tableElement);
					// 	// Block the counter to avoid nextBtn to increase the counter
					// 	allowCount = false;
					// 	changeInnerText(nextBtn, "TOUCH");
					// 	// Temporally disables all styles associated to nextBtn
					// 	disableBtn(nextBtn);
					// 	// Adds clickable functionalities to maptag elements
					// 	setMapTagEvent(0, "changeImage(event)");
					// } else if (counter === 9) {
					// 	highlightRow(tableElement);
					// 	allowCount = false;
					// 	setMapTagEvent(4, "continueCount(event)");
					// 	changeInnerText(nextBtn, "TOUCH");
					// 	disableBtn(nextBtn);
					// } else if (counter === 14) {
					// 	highlightRow(tableElement);
					// } else if (counter === 15) {
					// 	highlightRow(tableElement);
					// 	// Invokes Main Action changeImage(event)
					// 	changeImage(event);
					// }
				}
			});

			// ACTIONS on clickable maptag elements with no image change effects
			function continueCount(event) {
				if (!allowCount) {
					counter++;
					console.log("Estoy en Evento SIN cambio de Imagen: ", counter);
					const tableElement = document.getElementById(`item${counter}`);
					highlightRow(tableElement);
					const elementId = event.composedPath()[0].attributes.id.nodeValue;
					const element = document.getElementById(elementId);
					// Same as unsetMapTagEvent for each element
					element.classList.remove("clickable");
					element.removeAttribute("onclick");
					if (counter === 143) {
						setMapTagEvent(50, "changeImage(event)");
					} else if (counter === 410) {
						setMapTagEvent(55, "changeImage(event)");
					} else if (counter === 812) {
						setMapTagEvent(75, "changeImage(event)");
						allowCount = false;
					} else if (counter === 161) {
						allowCount = false;
					}
				}
			}

			// ACTIONS on clickable maptag elements with image change effects
			function changeImage(event) {
				allowCount = true;
				counter++;
				console.log("Estoy en Evento CON cambio de Imagen: ", counter);
				const cockpit = document.getElementById("cockpit");
				let cockpitImgRoute = cockpit.attributes.src.nodeValue;
				const tableElement = document.getElementById(`item${counter}`);
				if (cockpitImgRoute === imgsRoute + "cockpitcanopy.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpitoff.jpg";
					unsetMapTagEvent(0);
					highlightRow(tableElement);
					setMapTagEvent(1, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpitoff.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpitmaster.jpg";
					unsetMapTagEvent(1);
					highlightRow(tableElement);
					setMapTagEvent(2, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpitmaster.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpitmixture.jpg";
					unsetMapTagEvent(2);
					highlightRow(tableElement);
					setMapTagEvent(3, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpitmixture.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpitparking.jpg";
					unsetMapTagEvent(3);
					highlightRow(tableElement);
					changeInnerText(nextBtn, "NEXT")
					enableBtn(nextBtn)
					allowCount = true;
				} else if (cockpitImgRoute === imgsRoute + "cockpitparking.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpitposition.jpg";
					unsetMapTagEvent(4);
					highlightRow(tableElement);
					setMapTagEvent(5, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpitposition.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpitthrottle.jpg";
				    unsetMapTagEvent(5);
					highlightRow(tableElement);
					setMapTagEvent(2, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpitthrottle.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpittest1.jpg";
					unsetMapTagEvent(2);
					highlightRow(tableElement);
					setMapTagEvent(7, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpittest1.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpittest2.jpg";
					unsetMapTagEvent(7);
					highlightRow(tableElement);
					setMapTagEvent(1, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpittest2.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpittest3.jpg";
					unsetMapTagEvent(1);
					highlightRow(tableElement);
					setMapTagEvent(9, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpittest3.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpittest4.jpg";
					unsetMapTagEvent(9);
					highlightRow(tableElement);
					setMapTagEvent(5, "changeImage(event)");
				} else if (cockpitImgRoute === imgsRoute + "cockpittest4.jpg") {
					cockpit.attributes.src.nodeValue = imgsRoute + "cockpittest5.jpg";
					unsetMapTagEvent(5);
					highlightRow(tableElement);

				}
			}

			imageMapResize();
		</script>
	</body>
</html>
